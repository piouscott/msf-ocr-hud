<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>MSF - Gestion Counters</title>
  <link rel="stylesheet" href="popup.css">
  <script src="../lib/lucide.min.js"></script>
  <style>
    body {
      width: 450px;
      min-height: 580px;
      max-width: 100vw;
      background: linear-gradient(180deg, #0a0e1a 0%, #1a1a2e 50%, #0a0e1a 100%);
    }

    /* Mode fenêtré: layout adaptatif */
    body.windowed {
      width: 100% !important;
      max-width: 800px;
      min-height: 100vh;
      margin: 0 auto;
    }
    body.windowed #app {
      max-height: none;
      padding: 20px;
    }
    body.windowed header h1 {
      font-size: 24px;
    }
    body.windowed .team-section {
      padding: 16px;
    }
    body.windowed .team-portraits {
      gap: 4px;
    }
    body.windowed .team-portrait-thumb {
      width: 32px;
      height: 32px;
    }

    #app { max-height: calc(100vh - 20px); overflow-y: auto; }

    .back-link {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      color: #00d4ff;
      background: rgba(0, 212, 255, 0.1);
      border-radius: 8px;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.3s ease;
      border: 1px solid rgba(0, 212, 255, 0.3);
      flex-shrink: 0;
    }
    .back-link:hover {
      background: rgba(0, 212, 255, 0.2);
      border-color: #00d4ff;
      transform: translateX(-2px);
    }
    .back-link i {
      width: 20px;
      height: 20px;
    }

    .page-header {
      background: linear-gradient(135deg, #1e3a5f 0%, #0d1f33 100%);
      margin: -16px -16px 16px -16px;
      padding: 16px;
      border-bottom: 2px solid #00d4ff;
      position: relative;
      overflow: hidden;
    }

    .page-header::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M54.627 0l.83.828-1.415 1.415L51.8 0h2.827zM5.373 0l-.83.828L5.96 2.243 8.2 0H5.374zM48.97 0l3.657 3.657-1.414 1.414L46.143 0h2.828zM11.03 0L7.372 3.657 8.787 5.07 13.857 0H11.03zm32.284 0L49.8 6.485 48.384 7.9l-7.9-7.9h2.83zM16.686 0L10.2 6.485 11.616 7.9l7.9-7.9h-2.83zM22.344 0L13.858 8.485 15.272 9.9l9.9-9.9h-2.828zM32 0l-3.486 3.485-1.414-1.414L30.172 0H32z' fill='%2300d4ff' fill-opacity='0.03' fill-rule='evenodd'/%3E%3C/svg%3E");
      pointer-events: none;
    }

    .page-header h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
      color: #fff;
      text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      position: relative;
    }

    .header-title {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
      justify-content: center;
    }

    .header-title i {
      width: 22px;
      height: 22px;
    }

    @media (min-width: 500px) {
      .page-header h1 {
        font-size: 22px;
      }
      .header-title i {
        width: 24px;
        height: 24px;
      }
    }

    .team-section {
      background: linear-gradient(135deg, #252538 0%, #1e1e32 100%);
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 14px;
      border: 1px solid #2a2a3e;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    .team-section::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, #d4af37, transparent);
      opacity: 0;
      transition: opacity 0.3s;
    }
    .team-section:hover {
      border-color: #d4af37;
      box-shadow: 0 6px 20px rgba(212, 175, 55, 0.15);
      transform: translateY(-2px);
    }
    .team-section:hover::before {
      opacity: 1;
    }

    .team-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      cursor: pointer;
    }

    .team-name-title {
      font-weight: 600;
      color: #00d4ff;
    }

    .team-toggle {
      color: #888;
      font-size: 12px;
    }

    .counter-list {
      display: none;
    }

    .counter-list.expanded {
      display: block;
    }

    .counter-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px 8px;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #444;
    }

    .counter-row:last-child { border-bottom: none; }

    .counter-row select,
    .counter-row input {
      background: #1a1a2e;
      border: 1px solid #444;
      border-radius: 4px;
      color: #fff;
      padding: 4px 8px;
      font-size: 12px;
    }

    .counter-row select { width: 100%; }
    .counter-row input[type="number"] { width: 50px; }
    .counter-row .counter-notes {
      flex-basis: 100%;
    }

    .confidence-symbol {
      font-size: 12px;
      min-width: 32px;
      text-align: center;
    }

    .counter-row .btn-remove {
      background: #ff6b6b;
      color: #fff;
      border: none;
      border-radius: 4px;
      width: 22px;
      height: 22px;
      padding: 0;
      cursor: pointer;
      font-size: 11px;
      flex: 0 0 22px;
    }

    .btn-add-counter {
      background: #51cf66;
      color: #1a1a2e;
      border: none;
      border-radius: 4px;
      padding: 6px 12px;
      cursor: pointer;
      font-size: 12px;
      margin-top: 8px;
    }

    #save-bar {
      background: #1a1a2e;
      padding: 12px 0;
      border-top: 1px solid #444;
      text-align: center;
      margin-top: 12px;
    }

    #btn-save {
      background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
      color: #0a0e1a;
      border: none;
      border-radius: 8px;
      padding: 12px 32px;
      font-weight: 700;
      cursor: pointer;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
      transition: all 0.3s;
    }
    #btn-save:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 212, 255, 0.5);
      background: linear-gradient(135deg, #33ddff 0%, #00b3e6 100%);
    }
    #btn-save:active {
      transform: translateY(0);
    }

    /* Source badges */
    .source-legend {
      display: flex;
      gap: 16px;
      margin-bottom: 12px;
      font-size: 11px;
      color: #888;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .source-badge {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .source-badge.default { background: #888; }
    .source-badge.remote { background: #00d4ff; }
    .source-badge.custom { background: #51cf66; }

    .team-meta {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-reset {
      background: transparent;
      border: 1px solid #ff6b6b;
      color: #ff6b6b;
      border-radius: 4px;
      padding: 4px 10px;
      cursor: pointer;
      font-size: 11px;
      margin-left: 8px;
    }

    .btn-reset:hover {
      background: #ff6b6b;
      color: #fff;
    }

    /* Language selector */
    .lang-selector {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }
    .lang-selector label {
      font-size: 12px;
      color: #888;
    }
    .lang-btn {
      background: #2d2d44;
      border: 1px solid #444;
      color: #888;
      padding: 4px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }
    .lang-btn.active {
      background: #00d4ff;
      color: #1a1a2e;
      border-color: #00d4ff;
    }

    /* Team portraits thumbnails */
    .team-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .team-portraits {
      display: flex;
      gap: 2px;
      flex-wrap: wrap;
    }

    .team-portrait-thumb {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      object-fit: cover;
      border: 1px solid #444;
      background: #1a1a2e;
    }

    .team-portrait-placeholder {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      background: #444;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: #888;
      border: 1px solid #555;
    }

    /* Search bar */
    .search-bar {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      position: relative;
    }

    #search-input {
      flex: 1;
      background: linear-gradient(135deg, #1a1a2e 0%, #252538 100%);
      border: 1px solid #2a2a3e;
      border-radius: 8px;
      color: #fff;
      padding: 10px 16px;
      font-size: 13px;
      transition: all 0.3s;
      box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.3);
    }

    #search-input:focus {
      outline: none;
      border-color: #00d4ff;
      box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1), inset 0 2px 6px rgba(0, 0, 0, 0.3);
    }

    #search-input::placeholder {
      color: #666;
    }

    .btn-clear {
      background: transparent;
      border: 1px solid #444;
      color: #888;
      border-radius: 6px;
      padding: 0 12px;
      cursor: pointer;
      font-size: 16px;
    }

    .btn-clear:hover {
      background: #ff6b6b;
      color: #fff;
      border-color: #ff6b6b;
    }

    /* Accordéon offensif */
    .offensive-accordion {
      background: linear-gradient(135deg, #2d2744 0%, #1e1e32 100%);
      border-radius: 12px;
      margin-bottom: 16px;
      border: 1px solid #845ef7;
      overflow: hidden;
      box-shadow: 0 4px 16px rgba(132, 94, 247, 0.2);
      position: relative;
    }
    .offensive-accordion::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(180deg, #845ef7, #c084fc);
    }
    .offensive-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 14px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      color: #845ef7;
      user-select: none;
      transition: background 0.2s;
    }
    .offensive-header:hover {
      background: rgba(132, 94, 247, 0.1);
    }
    .offensive-arrow {
      font-size: 12px;
      color: #888;
      transition: transform 0.3s;
    }
    .offensive-accordion.expanded .offensive-arrow {
      transform: rotate(180deg);
    }
    .offensive-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .offensive-accordion.expanded .offensive-content {
      max-height: 2000px;
    }
    .offensive-team-card {
      padding: 8px 14px;
      border-top: 1px solid #3a3a55;
    }
    .offensive-team-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }
    .offensive-team-name {
      font-weight: 700;
      font-size: 13px;
      color: #fff;
    }
    .offensive-team-count {
      font-size: 11px;
      color: #845ef7;
      font-weight: 600;
    }
    .offensive-targets {
      display: none;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 6px;
    }
    .offensive-targets.show {
      display: flex;
    }
    .offensive-target {
      background: #1a1a2e;
      border-radius: 4px;
      padding: 3px 8px;
      font-size: 11px;
      color: #ccc;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .offensive-toggle-btn {
      background: none;
      border: none;
      color: #888;
      font-size: 11px;
      cursor: pointer;
      padding: 2px 0;
    }
    .offensive-toggle-btn:hover {
      color: #00d4ff;
    }

    .team-section.hidden {
      display: none;
    }

    .search-match {
      background: rgba(0, 212, 255, 0.15);
    }

    /* Counter team portraits */
    .counter-team-wrapper {
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
      min-width: 150px;
    }

    .counter-portraits {
      display: flex;
      gap: 2px;
      flex-wrap: wrap;
    }

    .counter-portrait-thumb {
      width: 20px;
      height: 20px;
      border-radius: 3px;
      object-fit: cover;
      border: 1px solid #444;
      background: #1a1a2e;
    }

    .counter-portrait-placeholder {
      width: 20px;
      height: 20px;
      border-radius: 3px;
      background: #444;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 8px;
      color: #888;
      border: 1px solid #555;
    }

    /* Badge "possédé" pour les counters que le joueur a */
    .owned-badge {
      background: #51cf66;
      color: #1a1a2e;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: bold;
      flex-shrink: 0;
    }

    .counter-owned {
      background: rgba(81, 207, 102, 0.1);
      border-left: 3px solid #51cf66;
      padding-left: 5px;
    }

    /* Badge indiquant qu'on a au moins un counter possédé pour cette équipe */
    .has-counter-badge {
      background: #51cf66;
      color: #1a1a2e;
      border-radius: 50%;
      width: 16px;
      height: 16px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: bold;
      margin-left: 6px;
      vertical-align: middle;
    }
  </style>
</head>
<body>
  <div id="app">
    <header class="page-header">
      <h1>
        <span class="back-link" id="back"><i data-lucide="arrow-left"></i></span>
        <span class="header-title">
          <i data-lucide="swords" style="color:#d4af37;"></i>
          <span data-i18n="title">Gestion Contres</span>
          <i data-lucide="shield" style="color:#51cf66;"></i>
        </span>
      </h1>
    </header>

    <div class="lang-selector">
      <label data-i18n="language">Langue:</label>
      <button class="lang-btn" data-lang="fr">FR</button>
      <button class="lang-btn" data-lang="en">EN</button>
    </div>

    <div id="source-legend" class="source-legend"></div>

    <div class="search-bar">
      <input type="text" id="search-input" placeholder="Rechercher equipe ou personnage...">
      <button id="search-clear" class="btn-clear" title="Effacer">&times;</button>
    </div>

    <!-- Accordéon: Meilleures équipes offensives -->
    <div id="offensive-accordion" class="offensive-accordion">
      <div class="offensive-header" id="offensive-toggle">
        <span><i data-lucide="trophy" style="width:16px;height:16px;color:#ffd43b;"></i> <span data-i18n="bestOffensive">Meilleures équipes offensives</span></span>
        <span class="offensive-arrow"><i data-lucide="chevron-down" style="width:14px;height:14px;"></i></span>
      </div>
      <div id="offensive-content" class="offensive-content">
        <!-- Généré par JS -->
      </div>
    </div>

    <div id="teams-container">
      <!-- Genere par JS -->
    </div>

    <div id="save-bar">
      <button id="btn-save">Sauvegarder</button>
      <span id="save-status"></span>
    </div>
  </div>

  <script src="manage.js"></script>
</body>
</html>
